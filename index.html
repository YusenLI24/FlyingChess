<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>飞行棋小游戏</title>
  <style>
  
  /* 页面基础样式 */
	body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f8ff;
    }
    
	/* 棋盘容器样式 */
	.board {
      position: relative;
      width: 403px;
      height: 503px;
      margin: 20px auto;
      background: #fff;
      border: 2px solid #000;
    }
    
	/* 每个格子的样式 */
	.cell {
      position: absolute;
      width: 50px;
      height: 50px;
      border: 1px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      font-weight: bold;
      color: white;
    }
    
	/* 每个格子上的心形图案 */
	.cell .heart {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.3;
      font-size: 32px;
      pointer-events: none;
    }
    
	/* 棋子样式 */
	.token {
      width: 32px;
      height: 32px;
      position: absolute;
      font-size: 34px;
      line-height: 32px;
      text-align: center;
      transition: all 0.4s ease;
      z-index: 10;
    }
    
	/* 掷骰按钮样式 */
	button {
      padding: 12px 24px;
      font-size: 20px;
      margin-top: 20px;
    }
    
	/* 当前状态栏样式 */
	#status {
      margin-top: 15px;
      font-size: 24px;
      font-weight: bold;
    }
    
	/* 当前玩家图标加大样式 */
	#status .player-icon {
      font-size: 30px;
      margin-left: 10px;
    }
    
	/* 弹窗样式 */
	.popup {
      position: fixed;
      top: 25%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 2px solid #000;
      padding: 20px;
      display: none;
      z-index: 100;
    }
    
	/* 胜利弹窗样式 */
	#winnerPopup {
      font-size: 22px;
      font-weight: bold;
      background: #fffbcc;
      border: 3px solid gold;
      padding: 20px 40px;
    }
  </style>
</head>
<body>

  <!-- 标题与游戏状态栏 -->
  <h2>飞行棋小游戏（李老师 & 小蛋糕）</h2>
  <div class="board" id="board"></div>
  <div id="status">当前回合：<span class="player-icon">👴</span></div>
  <button onclick="rollDice()">掷骰子</button>

  <!-- 弹窗结构 -->
  <div id="popup" class="popup">
    <p id="popupText"></p>
    <button id="popupCloseBtn" onclick="closePopup()">关闭</button>
  </div>

  <!-- 胜利提示弹窗 -->
  <div id="winnerPopup" class="popup">
    🎉 玩家 <span id="winnerPlayer"></span> 获胜！🎉
  </div>

<script>
  // 玩家图标
  const icons = ["👴", "🎂"];

  // DOM 元素引用
  const board = document.getElementById("board");
  const status = document.getElementById("status");
  const popup = document.getElementById("popup");
  const popupText = document.getElementById("popupText");
  const popupCloseBtn = document.getElementById("popupCloseBtn");

    // 棋盘路径格子坐标（从左上到右下绕一圈）
	const path = [
      [0, 0],[1, 0],[2, 0],[3, 0],[4, 0],[5, 0],[6, 0],[7, 0],
      [7, 1],[7, 2],[7, 3],[7, 4],[7, 5],[7, 6],[7, 7],[7, 8],[7, 9],
      [6, 9],[5, 9],[4, 9],[3, 9],[2, 9],[1, 9],
      [1, 8],[1, 7],[1, 6],[1, 5],[1, 4],[1, 3],[1, 2],
      [2, 2],[3, 2],[4, 2],[5, 2],
      [5, 3],[5, 4],[5, 5],[5, 6],[5, 7],
      [4, 7],[3, 7],
      [3, 6],[3, 5],[3, 4]
    ];

    // 根据格子数量生成彩色背景
	const colors = Array.from({ length: path.length }, (_, i) =>
      `hsl(${(i / path.length) * 360}, 80%, 60%)`
    );

  const events = {
	3: "亲对方10秒",
    4: "脚下踩空，后退 3 格...",
    5: "幸运星加持，再掷一次骰子！",
	6: "给对方一个深情拥抱",
    7: "打个盹，暂停一回合",
    8: "幸运满格，直接到终点！",
    9: "路遇善人，前进 4 格！",
    10: "幸运女神降临，前进 2 格！",
	11: "许个愿望",
    12: "真心话小游戏",
    13: "和好友拥抱，交换位置",
	14: "亲对方10秒",
	16: "学狗叫3次",
    19: "说我爱你",
	25: "给对方一个深情拥抱",
    28: "双倍幸运！前进 6 格！",
    32: "遇到岔路，随机跳到新位置！",
    33: "对视30秒不许笑",
    34: "碰到对手，被打飞回起点！",
    36: "掉进陷阱，后退 5 格！",
    39: "停电了，跳过下一回合"
  };

  // 两位玩家状态初始化
  const players = [
    { pos: 0, el: null, icon: "👴", skip: false },
    { pos: 0, el: null, icon: "🎂", skip: false }
  ];

  // 当前玩家编号（0 或 1）
  let currentPlayer = 0;

  // 创建棋盘格子 DOM 元素
  path.forEach(([x, y], i) => {
    const cell = document.createElement("div");
    cell.className = "cell";
    cell.style.left = `${x * 50}px`;
    cell.style.top = `${y * 50}px`;
    cell.style.background = colors[i];
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = "❤️";
    cell.appendChild(heart);
    const label = document.createElement("div");
    label.textContent = i;
    label.style.zIndex = 1;
    cell.appendChild(label);
    board.appendChild(cell);
  });

  // 创建玩家棋子元素
  players.forEach(p => {
    const el = document.createElement("div");
    el.className = "token";
    el.textContent = p.icon;
    board.appendChild(el);
    p.el = el;
  });

  // 渲染棋子在正确位置
  function renderTokens() {
    players.forEach(p => {
      const [x, y] = path[p.pos];
      p.el.style.left = `${x * 50 + 8}px`;
      p.el.style.top = `${y * 50 + 7}px`;
    });
  }

  // 显示弹窗，支持是否自动关闭
  function showPopup(message, autoClose = false) {
    popupText.textContent = message;
    popup.style.display = "block";
    popupCloseBtn.style.display = autoClose ? "none" : "inline-block";
  }

  // 关闭弹窗
  function closePopup() {
    popup.style.display = "none";
  }

  // 显示胜利弹窗
  function showWinner(playerIndex) {
    const winner = document.getElementById("winnerPlayer");
    const winPopup = document.getElementById("winnerPopup");
    winner.textContent = icons[playerIndex];
    winPopup.style.display = "block";
    winPopup.animate([{ opacity: 0.1 }, { opacity: 1 }], {
      duration: 1000,
      iterations: 3
    });
  }

  // 掷骰子逻辑
  function rollDice() {
    const player = players[currentPlayer];
    
	// 检查是否需跳过本轮
	if (player.skip) {
      showPopup(`玩家 ${icons[currentPlayer]} 跳过这回合`);
      popupCloseBtn.onclick = () => {
        closePopup();
        player.skip = false;
        currentPlayer = 1 - currentPlayer;
        status.innerHTML = `当前回合：<span class="player-icon">${icons[currentPlayer]}</span>`;
      };
      return;
    }

    // 正常掷骰子（1~6）
	const steps = Math.floor(Math.random() * 6) + 1;
    showPopup(`玩家 ${icons[currentPlayer]} 掷出了：${steps}`, true);
    
	// 自动关闭提示后开始移动
	setTimeout(() => {
      closePopup();
      movePlayer(steps);
    }, 1000);
  }

  // 移动玩家棋子并触发事件
  function movePlayer(steps) {
    const player = players[currentPlayer];
    let newPos = Math.min(player.pos + steps, path.length - 1);
    let step = player.pos;

    const interval = setInterval(() => {
      if (step < newPos) {
        step++;
        player.pos = step;
        renderTokens();
      } else {
        clearInterval(interval);
        const event = events[player.pos];
        if (event) {
		  // 显示事件弹窗
          showPopup(`格子 ${player.pos} 事件：${event}`);
          popupCloseBtn.onclick = () => {
            closePopup();
            
			// 执行事件效果
			if (event.includes("前进")) {
              const plus = parseInt(event.match(/\d+/)[0]);
              player.pos = Math.min(player.pos + plus, path.length - 1);
            } else if (event.includes("后退")) {
              const minus = parseInt(event.match(/\d+/)[0]);
              player.pos = Math.max(player.pos - minus, 0);
            } else if (event.includes("跳过") || event.includes("暂停")) {
              player.skip = true;
            } else if (event.includes("起点")) {
              player.pos = 0;
            } else if (event.includes("终点")) {
              player.pos = path.length - 1;
            } else if (event.includes("交换")) {
              const other = 1 - currentPlayer;
              [player.pos, players[other].pos] = [players[other].pos, player.pos];
            } else if (event.includes("随机")) {
              player.pos = Math.floor(Math.random() * path.length);
            } else if (event.includes("再掷")) {
              renderTokens();
              setTimeout(() => rollDice(), 500);
              return;
            }

            renderTokens();

            // 胜利判断
			if (player.pos === path.length - 1) {
              status.innerHTML = `🎉 <span class="player-icon">${icons[currentPlayer]}</span> 获胜！`;
              document.querySelector("button").disabled = true;
              showWinner(currentPlayer);
            } else {
              currentPlayer = 1 - currentPlayer;
              status.innerHTML = `当前回合：<span class="player-icon">${icons[currentPlayer]}</span>`;
            }
          };
        } else {
          // 没有事件：正常结束本轮
		  if (player.pos === path.length - 1) {
            status.innerHTML = `🎉 <span class="player-icon">${icons[currentPlayer]}</span> 获胜！`;
            document.querySelector("button").disabled = true;
            showWinner(currentPlayer);
          } else {
            currentPlayer = 1 - currentPlayer;
            status.innerHTML = `当前回合：<span class="player-icon">${icons[currentPlayer]}</span>`;
          }
        }
      }
    }, 400);
  }

  // 初始化棋子位置
  renderTokens();
</script>
</body>
</html>
