<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é£è¡Œæ£‹å°æ¸¸æˆ</title>
  <style>
   /* é¡µé¢åŸºç¡€æ ·å¼ */
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f8ff;
    }

	/* æ£‹ç›˜å®¹å™¨æ ·å¼ */
    .board {
      position: relative;
      width: 400px;
      height: 500px;
      margin: 20px auto;
      background: #fff;
      border: 2px solid #000;
    }

	/* æ¯ä¸ªæ ¼å­çš„æ ·å¼ */
    .cell {
      position: absolute;
      width: 50px;
      height: 50px;
      border: 1px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      font-weight: bold;
      color: white;
    }

	/* æ¯ä¸ªæ ¼å­ä¸Šçš„å¿ƒå½¢å›¾æ¡ˆ */
    .cell .heart {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.3;
      font-size: 32px;
      pointer-events: none;
    }

	/* æ£‹å­æ ·å¼ */
    .token {
      width: 32px;
      height: 32px;
      position: absolute;
      font-size: 32px;
      line-height: 32px;
      text-align: center;
      transition: all 0.4s ease;
      z-index: 10;
    }

	/* æ·éª°æŒ‰é’®æ ·å¼ */
    button {
      padding: 12px 24px;
      font-size: 20px;
      margin-top: 20px;
    }

	/* å½“å‰çŠ¶æ€æ æ ·å¼ */
    #status {
      margin-top: 15px;
      font-size: 24px;
      font-weight: bold;
    }

	/* å½“å‰ç©å®¶å›¾æ ‡åŠ å¤§æ ·å¼ */
    #status .player-icon {
      font-size: 30px;
      margin-left: 10px;
    }

	/* å¼¹çª—æ ·å¼ */
    .popup {
      position: fixed;
      top: 25%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 2px solid #000;
      padding: 20px;
      display: none;
      z-index: 100;
    }

	/* èƒœåˆ©å¼¹çª—æ ·å¼ */
    #winnerPopup {
      font-size: 22px;
      font-weight: bold;
      background: #fffbcc;
      border: 3px solid gold;
      padding: 20px 40px;
    }
  </style>
</head>
<body>

	<!-- æ ‡é¢˜ä¸æ¸¸æˆçŠ¶æ€æ  -->
  <h2>é£è¡Œæ£‹å°æ¸¸æˆï¼ˆæè€å¸ˆ & å°è›‹ç³•ï¼‰</h2>
  <div class="board" id="board"></div>
  <div id="status">å½“å‰å›åˆï¼š<span class="player-icon">ğŸ‘´</span></div>
  <button onclick="rollDice()">æ·éª°å­</button>

  <!-- å¼¹çª—ç»“æ„ -->
  <div id="popup" class="popup">
    <p id="popupText"></p>
    <button id="popupCloseBtn" onclick="closePopup()">å…³é—­</button>
  </div>

  <!-- èƒœåˆ©æç¤ºå¼¹çª— -->
  <div id="winnerPopup" class="popup">
    ğŸ‰ ç©å®¶ <span id="winnerPlayer"></span> è·èƒœï¼ğŸ‰
  </div>

  <script>
    // ç©å®¶å›¾æ ‡
	const icons = ["ğŸ‘´", "ğŸ‚"];
    
	// DOM å…ƒç´ å¼•ç”¨
	const board = document.getElementById("board");
    const status = document.getElementById("status");
    const popup = document.getElementById("popup");
    const popupText = document.getElementById("popupText");
    const popupCloseBtn = document.getElementById("popupCloseBtn");

    // æ£‹ç›˜è·¯å¾„æ ¼å­åæ ‡ï¼ˆä»å·¦ä¸Šåˆ°å³ä¸‹ç»•ä¸€åœˆï¼‰
	const path = [
      [0, 0],[1, 0],[2, 0],[3, 0],[4, 0],[5, 0],[6, 0],[7, 0],
      [7, 1],[7, 2],[7, 3],[7, 4],[7, 5],[7, 6],[7, 7],[7, 8],[7, 9],
      [6, 9],[5, 9],[4, 9],[3, 9],[2, 9],[1, 9],
      [1, 8],[1, 7],[1, 6],[1, 5],[1, 4],[1, 3],[1, 2],
      [2, 2],[3, 2],[4, 2],[5, 2],
      [5, 3],[5, 4],[5, 5],[5, 6],[5, 7],
      [4, 7],[3, 7],
      [3, 6],[3, 5],[3, 4]
    ];

    // æ ¹æ®æ ¼å­æ•°é‡ç”Ÿæˆå½©è‰²èƒŒæ™¯
	const colors = Array.from({ length: path.length }, (_, i) =>
      `hsl(${(i / path.length) * 360}, 80%, 60%)`
    );

     // ç‰¹æ®Šäº‹ä»¶å®šä¹‰ï¼ˆæ ¹æ®æ ¼å­ç¼–å·ï¼‰
    const events = {
      3: "å‰è¿› 2 æ ¼",
	  4: "å‰è¿› 2 æ ¼",
      5: "åé€€ 1 æ ¼",
	  8: "ç»§ç»­å‰è¿› 1 æ ¼",
      11: "è·³è¿‡ä¸‹ä¸€å›åˆ",
      17: "è·³è¿‡ä¸‹ä¸€å›åˆ",
      19: "äº¤æ¢ä½ç½®",
      23: "ç»§ç»­å‰è¿› 1 æ ¼",
      25: "å¤§å†’é™©ï¼",
	  30: "è·³è¿‡ä¸‹ä¸€å›åˆ",
	  34: "è·³è¿‡ä¸‹ä¸€å›åˆ"
    };

    // ä¸¤ä½ç©å®¶çŠ¶æ€åˆå§‹åŒ–
	const players = [
      { pos: 0, el: null, icon: "ğŸ‘´", skip: false },
      { pos: 0, el: null, icon: "ğŸ‚", skip: false }
    ];

    // å½“å‰ç©å®¶ç¼–å·ï¼ˆ0 æˆ– 1ï¼‰
	let currentPlayer = 0;

    // åˆ›å»ºæ£‹ç›˜æ ¼å­ DOM å…ƒç´ 
	path.forEach(([x, y], i) => {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.style.left = `${x * 50}px`;
      cell.style.top = `${y * 50}px`;
      cell.style.background = colors[i];

      const heart = document.createElement("div");
      heart.className = "heart";
      heart.textContent = "â¤ï¸";
      cell.appendChild(heart);

      const label = document.createElement("div");
      label.textContent = i;
      label.style.zIndex = 1;
      cell.appendChild(label);

      board.appendChild(cell);
    });

    // åˆ›å»ºç©å®¶æ£‹å­å…ƒç´ 
	players.forEach(p => {
      const el = document.createElement("div");
      el.className = "token";
      el.textContent = p.icon;
      board.appendChild(el);
      p.el = el;
    });

    // æ¸²æŸ“æ£‹å­åœ¨æ­£ç¡®ä½ç½®
	function renderTokens() {
      players.forEach(p => {
        const [x, y] = path[p.pos];
        p.el.style.left = `${x * 50 + 9}px`;
        p.el.style.top = `${y * 50 + 9}px`;
      });
    }

    // æ˜¾ç¤ºå¼¹çª—ï¼Œæ”¯æŒæ˜¯å¦è‡ªåŠ¨å…³é—­
	function showPopup(message, autoClose = false) {
      popupText.textContent = message;
      popup.style.display = "block";
      popupCloseBtn.style.display = autoClose ? "none" : "inline-block";
    }

    // å…³é—­å¼¹çª—
	function closePopup() {
      popup.style.display = "none";
    }

    // æ˜¾ç¤ºèƒœåˆ©å¼¹çª—
	function showWinner(playerIndex) {
      const winner = document.getElementById("winnerPlayer");
      const winPopup = document.getElementById("winnerPopup");
      winner.textContent = icons[playerIndex];
      winPopup.style.display = "block";
      winPopup.animate([{ opacity: 0.1 }, { opacity: 1 }, { opacity: 0.1 }, { opacity: 1 }], {
        duration: 1000,
        iterations: 3
      });
    }

    // æ·éª°å­é€»è¾‘
	function rollDice() {
      const player = players[currentPlayer];

      // æ£€æŸ¥æ˜¯å¦éœ€è·³è¿‡æœ¬è½®
	  if (player.skip) {
        showPopup(`ç©å®¶ ${icons[currentPlayer]} è·³è¿‡è¿™å›åˆ`);
        popupCloseBtn.onclick = () => {
          closePopup();
          player.skip = false;
          currentPlayer = 1 - currentPlayer;
          status.innerHTML = `å½“å‰å›åˆï¼š<span class="player-icon">${icons[currentPlayer]}</span>`;
        };
        return;
      }

      // æ­£å¸¸æ·éª°å­ï¼ˆ1~6ï¼‰
	  const steps = Math.floor(Math.random() * 6) + 1;
      showPopup(`ç©å®¶ ${icons[currentPlayer]} æ·å‡ºäº†ï¼š${steps}`, true);

      // è‡ªåŠ¨å…³é—­æç¤ºåå¼€å§‹ç§»åŠ¨
	  setTimeout(() => {
        closePopup();
        movePlayer(steps);
      }, 1000);
    }

    // ç§»åŠ¨ç©å®¶æ£‹å­å¹¶è§¦å‘äº‹ä»¶
	function movePlayer(steps) {
      const player = players[currentPlayer];
      let newPos = Math.min(player.pos + steps, path.length - 1);
      let step = player.pos;

      const interval = setInterval(() => {
        if (step < newPos) {
          step++;
          player.pos = step;
          renderTokens();
        } else {
          clearInterval(interval);

          const event = events[player.pos];
          if (event) {
            // æ˜¾ç¤ºäº‹ä»¶å¼¹çª—
			showPopup(`æ ¼å­ ${player.pos} äº‹ä»¶ï¼š${event}`);
            popupCloseBtn.onclick = () => {
              closePopup();

              // æ‰§è¡Œäº‹ä»¶æ•ˆæœ
			  if (event.includes("å‰è¿›")) {
                const plus = parseInt(event.match(/\d+/)[0]);
                player.pos = Math.min(player.pos + plus, path.length - 1);
              } else if (event.includes("åé€€")) {
                const minus = parseInt(event.match(/\d+/)[0]);
                player.pos = Math.max(player.pos - minus, 0);
              } else if (event.includes("è·³è¿‡")) {
                player.skip = true;
              } else if (event.includes("èµ·ç‚¹")) {
                player.pos = 0;
              } else if (event.includes("äº¤æ¢")) {
                const other = 1 - currentPlayer;
                [player.pos, players[other].pos] = [players[other].pos, player.pos];
              }

              renderTokens();

              // èƒœåˆ©åˆ¤æ–­
			  if (player.pos === path.length - 1) {
                status.innerHTML = `ğŸ‰ <span class="player-icon">${icons[currentPlayer]}</span> è·èƒœï¼`;
                document.querySelector("button").disabled = true;
                showWinner(currentPlayer);
              } else {
                currentPlayer = 1 - currentPlayer;
                status.innerHTML = `å½“å‰å›åˆï¼š<span class="player-icon">${icons[currentPlayer]}</span>`;
              }
            };
          } else {
            // æ²¡æœ‰äº‹ä»¶ï¼šæ­£å¸¸ç»“æŸæœ¬è½®
			if (player.pos === path.length - 1) {
              status.innerHTML = `ğŸ‰ <span class="player-icon">${icons[currentPlayer]}</span> è·èƒœï¼`;
              document.querySelector("button").disabled = true;
              showWinner(currentPlayer);
            } else {
              currentPlayer = 1 - currentPlayer;
              status.innerHTML = `å½“å‰å›åˆï¼š<span class="player-icon">${icons[currentPlayer]}</span>`;
            }
          }
        }
      }, 400);
    }

    // åˆå§‹åŒ–æ£‹å­ä½ç½®
	renderTokens();
  </script>
</body>
</html>
